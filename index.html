<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News Sentiment Â· VADER vs DistilBERT</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #60a5fa;
      --ok: #22c55e;
      --bad: #ef4444;
      --row: #0b1224;
      --border: #1f2937
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, #0b1021, #0f172a);
      font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Arial;
      color: var(--text)
    }

    .wrap {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 16px
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px
    }

    h1 {
      font-size: clamp(20px, 4vw, 28px);
      margin: 0
    }

    .btn {
      border: 1px solid var(--accent);
      color: #fff;
      background: var(--accent);
      padding: .55rem .9rem;
      border-radius: .55rem;
      cursor: pointer;
      font-weight: 600
    }

    .btn:hover {
      filter: brightness(1.08)
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
      overflow: hidden
    }

    .table-wrap {
      overflow: auto;
      max-height: 70vh
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0
    }

    thead th {
      position: sticky;
      top: 0;
      background: rgba(17, 24, 39, .9);
      backdrop-filter: saturate(1.2) blur(4px);
      padding: 12px;
      text-align: left;
      font-weight: 700;
      font-size: .92rem;
      border-bottom: 1px solid var(--border)
    }

    tbody td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      font-size: .95rem
    }

    tbody tr:nth-child(even) {
      background: var(--row)
    }

    a.title {
      color: #fff;
      text-decoration: none
    }

    a.title:hover {
      text-decoration: underline
    }

    .muted {
      color: var(--muted);
      font-size: .9rem
    }

    .pill {
      display: inline-block;
      padding: .15rem .45rem;
      border-radius: .5rem;
      font-weight: 700;
      font-size: .82rem
    }

    .pill-ok {
      background: rgba(34, 197, 94, .15);
      color: var(--ok);
      border: 1px solid rgba(34, 197, 94, .3)
    }

    .pill-bad {
      background: rgba(239, 68, 68, .15);
      color: var(--bad);
      border: 1px solid rgba(239, 68, 68, .3)
    }

    .pill-neutral {
      background: rgba(148, 163, 184, .15);
      color: var(--muted);
      border: 1px solid rgba(148, 163, 184, .3)
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace
    }

    .center {
      text-align: center
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1>News Sentiment Â· VADER vs DistilBERT</h1>
      <button class="btn" id="reloadBtn">Reload</button>
    </div>

    <div class="card">
      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th style="min-width:280px">Title</th>
              <th style="min-width:120px">Source</th>
              <th style="min-width:200px">Published (local)</th>
              <th style="min-width:140px">VADER (compound)</th>
              <th style="min-width:240px">DistilBERT (label Â· score or PENDING)</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr>
              <td colspan="5" class="center muted">Loadingâ€¦</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <p class="muted" style="margin-top:10px;">
      Expects: <span class="mono">{ articles: [ { title, source, url, publishedAt, vader:{compound},
        distilbert:{label,score} } ] }</span>
    </p>
  </div>

  <script>
    // ðŸ”— Your Amazon endpoint here
    const API_URL = "https://vus6woiowc.execute-api.us-east-1.amazonaws.com/default/NewsSentimentAnalysis";



    // âœ… Toggle this if you want to *always* use the proxy (for testing)
    const FORCE_PROXY = false;

    // A lightweight public CORS proxy for client-only demos.
    // In production, prefer your own tiny proxy (Vercel/Cloudflare Worker).
    const proxyURL = (url) =>
      `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

    const tbody = document.getElementById('tbody');
    const reloadBtn = document.getElementById('reloadBtn');

    function formatDate(s) {
      if (!s) return '';
      const d = new Date(s);
      return isNaN(d.getTime()) ? s : d.toLocaleString();
    }
    function labelPill(label) {
      const L = String(label || '').toUpperCase();
      if (L.includes('POS')) return `<span class="pill pill-ok">POSITIVE</span>`;
      if (L.includes('NEG')) return `<span class="pill pill-bad">NEGATIVE</span>`;
      if (L === 'PENDING') return `<span class="pill pill-neutral">PENDING</span>`;
      return `<span class="pill pill-neutral">${label || 'NEUTRAL'}</span>`;
    }
    function renderRows(articles) {
      tbody.innerHTML = '';
      if (!articles || !articles.length) {
        tbody.innerHTML = `<tr><td colspan="5" class="center muted">No articles.</td></tr>`;
        return;
      }
      for (const a of articles) {
        const title = a?.title ?? '';
        const url = a?.url ?? '#';
        const source = a?.source ?? '';
        const published = formatDate(a?.publishedAt);
        const vader = (a?.vader?.compound ?? '') === '' ? '' : Number(a.vader.compound).toFixed(3);
        const dLabel = a?.distilbert?.label ?? '';
        const dScore = a?.distilbert?.score == null ? '' : Number(a.distilbert.score).toFixed(3);
        const distil = `${labelPill(dLabel)}${dScore ? ' Â· ' + dScore : ''}`;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><a class="title" href="${url}" target="_blank" rel="noopener">${title}</a></td>
          <td class="muted">${source}</td>
          <td class="muted">${published}</td>
          <td class="mono">${vader}</td>
          <td>${distil}</td>
        `;
        tbody.appendChild(tr);
      }
    }
    function renderError(message) {
      tbody.innerHTML = `<tr><td colspan="5" class="center" style="color:#fca5a5">Failed to load: ${message}</td></tr>`;
    }

    async function fetchJSON(url, { useProxy = false } = {}) {
      const target = useProxy ? proxyURL(url) : url;
      // Use only â€œsimpleâ€ GET options to avoid CORS preflight
      const resp = await fetch(target, {
        method: 'GET',
        cache: 'no-store',
        referrerPolicy: 'no-referrer',
        // No custom headers â†’ keeps the request â€œsimpleâ€
      });
      // Some endpoints mislabel content-type; fall back to textâ†’JSON
      const ct = resp.headers.get('content-type') || '';
      if (!resp.ok) {
        const txt = await resp.text().catch(() => '');
        throw new Error(`HTTP ${resp.status} ${resp.statusText} Â· ${txt.slice(0, 140)}`);
      }
      if (ct.includes('application/json')) {
        return resp.json();
      } else {
        const txt = await resp.text();
        try { return JSON.parse(txt); }
        catch { throw new Error('Response not valid JSON'); }
      }
    }

    async function loadData() {
      tbody.innerHTML = `<tr><td colspan="5" class="center muted">Loadingâ€¦</td></tr>`;
      try {
        const json = await fetchJSON(API_URL, { useProxy: FORCE_PROXY });
        const rows = Array.isArray(json?.articles) ? json.articles
          : Array.isArray(json) ? json
            : json ? [json] : [];
        renderRows(rows);
      } catch (e1) {
        console.warn('Direct fetch failed, retrying via proxy:', e1);
        try {
          const json = await fetchJSON(API_URL, { useProxy: true });
          const rows = Array.isArray(json?.articles) ? json.articles
            : Array.isArray(json) ? json
              : json ? [json] : [];
          renderRows(rows);
        } catch (e2) {
          console.error('Proxy fetch failed:', e2);
          renderError(e2.message || 'Network/CORS error');
        }
      }
    }

    window.addEventListener('DOMContentLoaded', loadData);
    reloadBtn.addEventListener('click', loadData);
  </script>
</body>

</html>
